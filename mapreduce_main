# libraries for csv file reading csv.DictReader and defauldict for creating empty lists for any new key
import csv
from collections import defaultdict


#  File Reader 
def reader(file_path):
    rows = []
    with open(file_path, "r", encoding='utf-8') as f:
        r = csv.DictReader(f)
        for row in r:
            rows.append(row)
    return rows




#  Mapper 
def mapper(row):
    # strip() for removing whitespace in the columns
    g = row["Fav genre"].strip()
    a = row["Anxiety"].strip()
    d = row["Depression"].strip()
    
# skipping any row with a missing parameter 
    if g == "" or a == "" or d == "":
        return None
        
# returns only flat values
    return g, float(a), float(d)      



# Shuffle and sort
def shuffle(mappeddata):
    grouped = defaultdict(list)

    # returning grouped data with each genre 
    for g, a, d in mappeddata:
        grouped[g].append((a, d))

    return grouped


# Reducer
def reducer(grouped):
    # holding final result
    out = {}
    # calculating avg
    for g, vals in grouped.items():
        totala = 0
        totald = 0
        count = 0

        for a, d in vals:
            totala += a
            totald += d
            count += 1

        avg_a = round(totala / count, 2)
        avg_d = round(totald / count, 2)

        out[g] = (avg_a, avg_d, count)
    return out

# Kaggle Dataset
file_path = "/kaggle/input/mxmh-survey-results/mxmh_survey_results.csv"

rows = reader(file_path)

# map + remove None
mapped = [m for m in (mapper(r) for r in rows) if m is not None]

# sort + reduce
grouped = shuffle(mapped)
reduced = reducer(grouped)



for g, (avg_a, avg_d, c) in reduced.items():
    print('\nGENRE: ',g,'\n       AVG ANXIETY: ', avg_a,'\n       AVG DEPRESSION: ', avg_d,'\n       COUNT: ', c)
